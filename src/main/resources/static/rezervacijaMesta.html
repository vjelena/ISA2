<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Rezervacija mesta</title>
		<script src="scripts/jquery-3.2.1.min.js"></script>
		<link href="bootstrapB/css/bootstrap.css" rel="stylesheet" type="text/css"/>
		<script src="bootstrapB/js/bootstrap.js" type="text/javascript"></script>
	</head>

	<body>
		<div class="row">
			<div class="col-lg-12 col-lg-9"></div>
  			<div class="col-lg-6 col-lg-3">
			    <div class="form-group">
			    	<form class="form-horizontal">
				        <div class="col-lg-4">
				            <input id="dugmeNazad" class="btn btn-link" type="button" value="Nazad">
				        </div>
				  	</form>
			    </div>
  			</div>
  			<form class="form-horizontal">
				<div class="col-lg-4">
				   	<h4><label>Rezervacija mesta u bioskopu: </label></h4>
				</div>
			</form>
		</div>
		
		<div class="container">
   			<div style="margin-top:20px;" class="mainbox col-lg-10 col-lg-offset-3 col-lg-11 col-lg-offset-7"> 
				
				<div id="deo1">
					<!-- PRETRAGA BIOSKOPA -->
					<div class="form-group col-lg-10">
						<div style="padding-top: 1px">
							<div class="form-group col-lg-5">
								<div class="row">
									<div class="form-group has-feedback">
										<input type="text" class="form-control" id="pretraziBioskope" placeholder="Pretrazi bioskope">
										<span class="glyphicon glyphicon-search form-control-feedback"></span>
									</div>
								</div>
							</div>
							<div class="form-group col-lg-5">
								<div class="row">
									<div class="form-group has-feedback">
										<input id="dugmePretraziBioskope" type="button" class="btn btn-warning" style="float:right" onclick="pretraziBioskope()" value="Pretrazi bioskope">
									</div>
								</div>
							</div>
						</div>
					</div>
					
					
					<!-- ODABIR BIOSKOPA IZ LISTE -->
					<div class="form-group col-lg-10">
						<div class="form-group col-lg-3">
							<div class="row">
								<div id="lblNazivBioskopa" class="form-group has-feedback">
									<label>Naziv bioskopa:</label>
								</div>
							</div>
						</div>
						<div class="form-group col-lg-5">
							<div class="row">
								<div class="form-group has-feedback">
									<div id="listaBioskopa"></div>
								</div>
							</div>
						</div>
						<div class="form-group col-lg-2">
							<div class="row">
								<div class="form-group has-feedback">
									<input id="dugmeDalje1" type="button" class="btn btn-warning" style="float:right" value="Dalje 1">
								</div>
							</div>
						</div>
					</div>
				</div>
				
				
				<div id="deo2">
					<!-- ODABIR PROJEKCIJE IZ LISTE -->
					<!-- sakriti dugme dalje1 -->
					<div class="form-group col-lg-10">
						<div style="padding-top: 40px">
							<div class="form-group col-lg-3">
								<div class="row">
									<div class="form-group has-feedback">
										<label>Projekcija:</label>
									</div>
								</div>
							</div>
							<div class="form-group col-lg-5">
								<div class="row">
									<div id="listaProjekcija" class="form-group has-feedback"></div>
								</div>
							</div>
							<div class="form-group col-lg-2">
								<div class="row">
									<div class="form-group has-feedback">
										<input id="dugmeNastaviTermin" type="button" class="btn btn-success" style="float:right" value="Odabir termina...">
									</div>
								</div>
							</div>
						</div>
					</div>
					
					
					<!-- ODABIR TERMINA -->
					<div class="form-group col-lg-10">
						<div class="form-group col-lg-3">
							<div class="row">
								<div id="lblTermin" class="form-group has-feedback">
									<label>Termin (datum i vreme):</label>
								</div>
							</div>
						</div>
						<div class="form-group col-lg-5">
							<div class="row">
								<div id="listaTermina" class="form-group has-feedback"></div>
							</div>
						</div>
						<div class="form-group col-lg-2">
							<div class="row">
								<div class="form-group has-feedback">
									<input id="dugmeNastaviSala" type="button" class="btn btn-success" style="float:right" value="Odabir sale...">
								</div>
							</div>
						</div>
					</div>
					
					
					<!-- ODABIR SALE -->
					<!-- sakriti dugme dalje1 -->
					<div class="form-group col-lg-10">
						<div class="form-group col-lg-3">
							<div class="row">
								<div id="lblSala" class="form-group has-feedback">
									<label>Sala:</label>
								</div>
							</div>
						</div>
						<div class="form-group col-lg-5">
							<div class="row">
								<div id="listaSala" class="form-group has-feedback"></div>
							</div>
						</div>
						<div class="form-group col-lg-2">
							<div class="row">
								<div class="form-group has-feedback">
									<input id="dugmeDalje2" type="button" class="btn btn-success" style="float:right" value="Dalje 2">
								</div>
							</div>
						</div>
					</div>
				</div>
				
				
				<div id="deo3">
					<!-- GRAFICKI PRIKAZ -->
					<!-- sakriti dugme dalje2 -->
					<div class="form-group col-lg-10">
						<div style="padding-top: 40px">
							<div class="form-group col-lg-5">
								<div class="row">
									<div class="form-group has-feedback">
										<div id="grafickiPrikaz">OVDE CE BITI GRAFICKI PRIKAZ</div>
									</div>
								</div>
							</div>
							<div class="form-group col-lg-5">
								<div class="row">
									<div class="form-group has-feedback">
										<input id="dugmeDalje3" type="button" class="btn btn-secondary" style="float:right" value="Dalje 3">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				
				<div id="deo4">
					<!-- PRETRAGA PRIJATELJA -->
					<!-- sakriti dugme dalje3 -->
					<div class="form-group col-lg-10">
						<div style="padding-top: 40px">
							<div class="form-group col-lg-5">
								<div class="row">
									<div class="form-group has-feedback">
										<input type="text" class="form-control" id="pretraziPrijatelje" placeholder="Pretrazi prijatelje">
										<span class="glyphicon glyphicon-search form-control-feedback"></span>
									</div>
								</div>
							</div>
							<div class="form-group col-lg-5">
								<div class="row">
									<div class="form-group has-feedback">
										<input id="dugmePretraziPrijatelje" type="button" class="btn btn-danger" style="float:right" value="Pretrazi prijatelje">
									</div>
								</div>
							</div>
						</div>
					</div>
					
					
					<!-- ODABIR PRIJATELJA IZ LISTE -->
					<div class="form-group col-lg-10">
						<div class="form-group col-lg-3">
							<div class="row">
								<div class="form-group has-feedback">
									<label>Odaberi prijatelja:</label>
								</div>
							</div>
						</div>
						<div class="form-group col-lg-4">
							<div class="row">
								<div class="form-group has-feedback">
									<select class="form-control" id="selectPrijatelji">
										<option>Prijatelj 1</option>
										<option>Prijatelj 2</option>
									</select>
								</div>
							</div>
						</div>
						<div class="form-group col-lg-3">
							<div class="row">
								<div class="form-group has-feedback">
									<input id="dugmePozoviPrijatelje" type="button" class="btn btn-danger" style="float:right" value="Pozovi prijatelje">
									<input id="dugmeDalje4" type="button" class="btn btn-danger" style="float:right" value="Dalje 4">
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<!-- ZAVRSETAK REZERVACIJE -->
				<div id="deo5" class="form-group col-lg-10">
					<div style="padding-top: 40px">
						<div class="form-group col-lg-10">
							<div class="row">
								<div class="form-group has-feedback">
									<input id="dugmeZavrsiRezervaciju" type="button" class="btn btn-primary" style="float:right" value="Zavrsi rezervaciju">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="form-group col-lg-8">
					<h4><span id="prazno" class="row"></span></h4>
				</div>
				<!-- KRAJ -->			
			</div>
		</div>
		
		<script type="text/javascript">
			$(document).ready(function(){
				$("#deo1").show();
				$("#lblNazivBioskopa").hide();
				$("#deo2").hide();
				$("#deo3").hide();
				$("#deo4").hide();
				$("#deo5").hide();
				$("#dugmeDalje1").hide();
				
			});	
		
		
			$("#dugmeNazad").click(function(){
				location.href = "http://localhost:8080/homePage.html"
			});
			
			
			function pretraziBioskope(){
				document.getElementById("dugmePretraziBioskope").onclick = function() {
				    //da se select ne bi pojavio x puta :D
					this.disabled = true;
				}
				$("#dugmeDalje1").show();
				var naziv = $("#pretraziBioskope").val();
	
				if(naziv == ""){
					naziv = "nemaUnosa";
				}
				
				$.ajax({	
					url: "bioskopi/pretraziBioskope/" + naziv,
					type: "GET",
					success: function(data){
						if(data.length != 0){ //ima rezultata pretrage
							$("#lblNazivBioskopa").show();
							
							var listaBioskopaDiv = document.getElementById("listaBioskopa");							
							var selectList = document.createElement("select");
							selectList.id = "listaBioskopaSelect";
							listaBioskopaDiv.appendChild(selectList);
							
							for (i = 0; i < data.length; i++) {	
								//ako ima unosa prikazuje se samo 1 bioskop, sa unetim nazivom
								if(data[i].naziv == naziv){
									var option = document.createElement("option");
								    option.value = data[i].id;
								    option.text = data[i].naziv;
								    selectList.appendChild(option);
							    } else {
							    	//ako nema unosa prikazuju se svi bioskopi
							    	var option = document.createElement("option");
									option.value = data[i].id;
									option.text = data[i].naziv;
									selectList.appendChild(option);
							    }
							}
						} else {
							alert('Nema rezultata pretrage. \nMolimo pokusajte ponovo.');
							$("#pretraziBioskope").val('');
						}
				 	},
				 	error: function(data){
						alert('GRESKA PRILIKOM PRETRAGE BIOSKOPA!!!')
					}
				});
			}
			
			
			$("#dugmeDalje1").click(function(){
				$("#deo1").show();
				$("#deo2").show();
				$("#dugmeDalje2").hide();
				$("#deo3").hide();
				$("#deo3").hide();
				$("#deo4").hide();
				$("#deo5").hide();
				
				if($('#listaBioskopaSelect').val() != ""){
					var nazivSelektovanogBioskopa = $('#listaBioskopaSelect option:selected').text();
					alert(nazivSelektovanogBioskopa);
					
					$.ajax({	
						url: "http://localhost:8080/bioskopi/projekcijeIzRepertoaraSelektovanogBioskopa/" + nazivSelektovanogBioskopa,
						type: "GET",
						success: function(data){
							if(data.length != 0){
								//odabir projekcije
								var listaProjekcijaDiv = document.getElementById("listaProjekcija");							
								var selectListProjekcije = document.createElement("select");
								selectListProjekcije.id = "listaProjekcijaSelect";
								listaProjekcijaDiv.appendChild(selectListProjekcije);
								
								for (i = 0; i < data.length; i++) {
									var optionProjekcije = document.createElement("option");
									optionProjekcije.value = data[i].id;
									optionProjekcije.text = data[i].film.naziv;
									selectListProjekcije.appendChild(optionProjekcije);
								}
								
								$("#lblTermin").hide();
								$("#lblSala").hide();
								$("#dugmeDalje2").hide();
								$("#dugmeNastaviSala").hide();
								$("#div3").hide();
								$("#div4").hide();
								$("#div5").hide();
								
								//odabir termina i datuma
								$("#dugmeNastaviTermin").click(function(){
									var nazivSelektovaneProjekcije = $('#listaProjekcijaSelect option:selected').text();
									alert(nazivSelektovaneProjekcije);
									
									var listaTerminaDiv = document.getElementById("listaTermina");							
									var selectListTermini = document.createElement("select");
									selectListTermini.id = "listaTerminaSelect";
									listaTerminaDiv.appendChild(selectListTermini);
									
									for (i = 0; i < data.length; i++) {
										var optionTermini = document.createElement("option");
										optionTermini.value = data[i].termin.id;
										optionTermini.text = data[i].termin.vreme;
										selectListTermini.appendChild(optionTermini);
									}
									
									$("#dugmeDalje2").hide();
									$("#dugmeNastaviSala").show();
									$("#lblTermin").show();
									$("#div3").hide();
									$("#div4").hide();
									$("#div5").hide();
								});
								
								//odabir sale
								$("#dugmeNastaviSala").click(function(){
									var odabranTermin = $('#listaTerminaSelect option:selected').text();
									alert(odabranTermin);
									
									var listaSalaDiv = document.getElementById("listaSala");							
									var selectListSale = document.createElement("select");
									selectListSale.id = "listaSalaSelect";
									listaSalaDiv.appendChild(selectListSale);
									
									for (i = 0; i < data.length; i++) {
										var optionSale = document.createElement("option");
										optionSale.value = data[i].sala.id;
										optionSale.text = data[i].sala.nazivSale;
										selectListSale.appendChild(optionSale);
									}
									
									$("#lblSala").show();
									$("#dugmeDalje2").show();
									$("#deo3").hide();
									$("#div4").hide();
									$("#div5").hide();
								});
								//kraj odabira sale
							} else {
								$("#prazno").empty();
								$("#deo2").hide();
								$("#deo3").hide();
								$("#deo4").hide();
								$("#deo5").hide();
								$("#prazno").append("Nema projekcija na repertoaru selektovanog bioskopa.");
							}
					 	},
					 	error: function(data){
							alert('GRESKA PRILIKOM PRIKAZA PROJEKCIJA KOJE SU NA REPERTOARU SELEKTOVANOG BIOSKOPA!!!')
						}
					});
				} else {
					alert('Za nastavak postupka rezervacije mesta, morate odabrati naziv bioskopa.');
				}
			});
			
			
			$("#dugmeDalje2").click(function(){
				$("#deo1").show();
				$("#deo2").show();
				$("#deo3").show();
				$("#deo4").hide();
				$("#deo5").hide();
			});
			
			
			$("#dugmeDalje3").click(function(){
				$("#deo1").show();
				$("#deo2").show();
				$("#deo3").show();
				$("#deo4").show();
				$("#deo5").hide();
			});
			
			
			$("#dugmeDalje4").click(function(){
				$("#deo1").show();
				$("#deo2").show();
				$("#deo3").show();
				$("#deo4").show();
				$("#deo5").show();
			});
		</script>
	</body>
</html>